<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contactos - Agenda Web</title>
    <link rel="stylesheet" href="/style/contactos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-address-book"></i>
                <span>Agenda Web</span>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div>
                    <div id="userEmail">usuario@ejemplo.com</div>
                    <a href="../index.html" style="color: white; font-size: 12px;">Cerrar sesión</a>
                </div>
            </div>
        </div>
    </header>

    <nav class="nav-menu">
        <ul class="nav-links">
            <li><a href="contactos.html" class="active"><i class="fas fa-users"></i> Contactos</a></li>
            <li><a href="favoritos.html"><i class="fas fa-star"></i> Favoritos</a></li>
            <li><a href="todo.html"><i class="fas fa-tasks"></i> To-Do List</a></li>
            <li><a href="perfil.html"><i class="fas fa-user"></i> Perfil</a></li>
        </ul>
    </nav>

    <main class="main-container">
        <div class="page-title">
            <h1><i class="fas fa-users"></i> Mis Contactos <span id="contactCount"
                    style="font-size: 18px; color: #666; margin-left: 10px;"></span></h1>
            <a href="/pages/nuevoContacto.html" class="btn-primary">
                <i class="fas fa-plus"></i> Nuevo Contacto
            </a>
        </div>

        <div class="contacts-container" id="contactsList">
        </div>
    </main>

    <script>
        function getInitials(fullName) {
            const names = fullName.split(' ');
            if (names.length >= 2) {
                return (names[0].charAt(0) + names[1].charAt(0)).toUpperCase();
            }
            return fullName.substring(0, 2).toUpperCase();
        }

        function saveContactToStorage(contact) {
            let contacts = JSON.parse(localStorage.getItem('contacts')) || [];
            contacts.push(contact);
            localStorage.setItem('contacts', JSON.stringify(contacts));
        }

        function getCategoryLabel(category) {
            const categories = {
                'family': 'Familiar',
                'friend': 'Amigo',
                'work': 'Colega de trabajo',
                'other': 'Otro'
            };
            return categories[category] || 'Contacto';
        }

        function renderContacts() {
            const contactsList = document.getElementById('contactsList');
            const contactCount = document.getElementById('contactCount');

            let contacts = JSON.parse(localStorage.getItem('contacts')) || [];

            if (contacts.length === 0) {
                contacts = [
                    {
                        id: '1',
                        fullName: 'María López',
                        initials: 'ML',
                        phone: '+502 2234 5678',
                        email: 'maria.lopez@email.com',
                        position: 'Diseñadora Gráfica',
                        category: 'friend',
                        isFavorite: false
                    },
                    {
                        id: '2',
                        fullName: 'Carlos Rodríguez',
                        initials: 'CR',
                        phone: '+502 2345 6789',
                        email: 'c.rodriguez@email.com',
                        position: 'Desarrollador de Software',
                        category: 'work',
                        isFavorite: false
                    },
                    {
                        id: '3',
                        fullName: 'Ana García',
                        initials: 'AG',
                        phone: '+502 3456 7890',
                        email: 'ana.garcia@email.com',
                        position: 'Médico General',
                        category: 'family',
                        isFavorite: false
                    },
                    {
                        id: '4',
                        fullName: 'Pedro Martínez',
                        initials: 'PM',
                        phone: '+502 4567 8901',
                        email: 'pedro.martinez@email.com',
                        position: 'Arquitecto',
                        category: 'friend',
                        isFavorite: false
                    },
                    {
                        id: '5',
                        fullName: 'Laura Hernández',
                        initials: 'LH',
                        phone: '+502 5678 9012',
                        email: 'laura.hdz@email.com',
                        position: 'Contadora Pública',
                        category: 'other',
                        isFavorite: false
                    }
                ];
                localStorage.setItem('contacts', JSON.stringify(contacts));
            }

            contactCount.textContent = `(${contacts.length} contactos)`;

            contactsList.innerHTML = '';

            contacts.forEach(contact => {
                const contactCard = document.createElement('div');
                contactCard.className = 'contact-card';
                contactCard.dataset.id = contact.id;

                const favoriteBadge = contact.isFavorite ?
                    `<div class="favorite-badge">
                        <i class="fas fa-star"></i> Favorito
                    </div>` : '';

                contactCard.innerHTML = `
                    <div class="contact-header">
                        <div class="contact-avatar">${contact.initials}</div>
                        <div class="contact-info">
                            <h3>${contact.fullName}</h3>
                            <p>${getCategoryLabel(contact.category)}</p>
                            ${favoriteBadge}
                        </div>
                    </div>
                    <ul class="contact-details">
                        <li><i class="fas fa-phone"></i> ${contact.phone}</li>
                        ${contact.email ? `<li><i class="fas fa-envelope"></i> ${contact.email}</li>` : ''}
                        ${contact.position ? `<li><i class="fas fa-briefcase"></i> ${contact.position}</li>` : ''}
                    </ul>
                `;

                contactCard.addEventListener('click', function () {
                    localStorage.setItem('selectedContact', JSON.stringify(contact));
                    window.location.href = 'detalles-contacto.html';
                });

                contactsList.appendChild(contactCard);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            const userEmail = localStorage.getItem('userEmail') || 'usuario@ejemplo.com';
            document.getElementById('userEmail').textContent = userEmail;

            const userInitial = userEmail.charAt(0).toUpperCase();
            document.getElementById('userAvatar').textContent = userInitial;

            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (!isLoggedIn || isLoggedIn !== 'true') {
                window.location.href = '../index.html';
            }


            const logoutLink = document.querySelector('a[href="../index.html"]');
            if (logoutLink) {
                logoutLink.addEventListener('click', function (e) {
                    e.preventDefault();

                    localStorage.removeItem('userEmail');
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('todoTasks');


                    window.location.href = '../index.html';
                });
            }


            renderContacts();
        });
    </script>
</body>

</html>